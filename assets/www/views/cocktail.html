<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="../javascripts/cordova-2.3.0.js"></script>
    <script src="../javascripts/spin.min.js"></script>
    <script src="../javascripts/locale.js"></script>
    <script src="../javascripts/jquery-1.8.2.min.js"></script>
    <script src="../javascripts/controllers/base_controller.js"></script>
    <script src="../javascripts/controllers/cocktails_controller.js"></script>
    <script src="../javascripts/cocktail.js"></script>
    <script src="../javascripts/optionsMenu.js"></script>
    <script src="../javascripts/bootstrap/bootstrap.min.js"></script>
    <link media="screen" rel="stylesheet" href="../stylesheets/bestCocktails.css" />
    <!--
    <link media="screen" rel="stylesheet" href="../stylesheets/bootstrap/bootstrap.min.css" />
    <link media="screen" rel="stylesheet" href="../stylesheets/bootstrap/bootstrap-responsive.min.css" />-->
    <link media="screen" rel="stylesheet" href="../stylesheets/reset.css" />
    <link media="screen" rel="stylesheet" href="../stylesheets/style.css" />
    
    <!-- Facebook plugin -->
    
    <link rel="stylesheet" type="text/css" href="../stylesheets/facebook-style.css">
    <script type="text/javascript" src="../javascripts/facebook-js/index.js"></script>
    <!-- cordova facebook plugin -->
    <script src="../javascripts/cdv-plugin-fb-connect.js"></script>
    <!-- facebook js sdk -->
    <script src="../javascripts/facebook_js_sdk.js"></script> 
    
    <!--<script src="js/_config.js"></script>-->
    <script src="../javascripts/facebook-js/ui.js"></script>
    <script src="../javascripts/facebook-js/auth.js"></script>
    <script src="../javascripts/facebook-js/feed.js"></script>
    <script src="../javascripts/facebook-js/graph_api.js"></script>
    <script src="../javascripts/facebook-js/requests.js"></script>

    <script>
    
      document.addEventListener("deviceready", function(){
        FB.init({
            appId: '326614590799358',
            nativeInterface: CDV.FB,
            useCachedDialogs: false
        });
        authUser();
        
        var cocktail_id = getUrlParameters("id").id;
        console.log("cocktail_id: " + cocktail_id);
        if (cocktail_id == 'r') {
          $.ajax({
            type : "GET",
            url : server_url + cocktails_route + "/recommended",
            dataType : "json",
            async : false,
            success : function(data) {
              fillData(data, "Sinatra Cockteleria");
            },
            error : function(header, status, from) {
              alert("Error con el servidor");
            }
          });
        } else {
          console.log("no es recomendado");
          $.ajax({
            type : "GET",
            url : server_url + cocktails_route + "/" + cocktail_id,
            dataType : "json",
            async : false,
            success : function(data) {
              cocktail = data;
              console.log("cocktail: " + cocktail);
              $.ajax({
                type : "GET",
                url : "http://graph.facebook.com/" + cocktail.creador,
                dataType : "json",
                async : false,
                success : function(data2) {
                  fillData(cocktail, data2.name);
                },
                error : function(header, status, from) {
                  alert("Error con el servidor");
                }
              });
            },
            error : function(header, status, from) {
              alert("Error con el servidor");
            }
          });
        }
        
        $('#cocktailMoreImg').hover(function() {
          $(this).attr('src', '../images/ic_cocktail_zoom_hover.png');
        }, function() {
          $(this).attr('src', '../images/ic_cocktail_zoom.png');
        });
        
        $('#cocktailStarImg').hover(function() {
          $(this).attr('src', '../images/ic_cocktail_star_hover.png');
        }, function() {
          $(this).attr('src', '../images/ic_cocktail_star.png');
        });
        
      }, false);

      function fillData(cktl, user_name) {
        console.log("Fill data");
        var locale = getBrowserLocale();
        $('#info').show();
        color_array = cktl.imagen.split('_');
        console.log("color_array: " + color_array);
        color = color_array[color_array.length - 1].split('.')[0];

        $('#cocktail_image').attr("src", server_url + cktl.imagen);

        if (color == "Amarillo")
          $('#cocktail_image').attr("class", "border-amarillo");
        else if (color == "Verde")
          $('#cocktail_image').attr("class", "border-verde");
        else if (color == "Rojo")
          $('#cocktail_image').attr("class", "border-rojo");
        else if (color == "Naranja")
          $('#cocktail_image').attr("class", "border-naranja");

        $('#cocktail_info').append('<span class=\"title_section\">' + i18n["Creador"][locale] + ': </span> ' + user_name + '<br>' + '<span class=\"title_section\">' + i18n["Zumo"][locale] + ': </span> ' + cktl.zumos.join(', ') + '<br>');
        if (cktl.licores.length > 0)
          $('#cocktail_info').append('<span class=\"title_section\">' + i18n["Licor"][locale] + ': </span> ' + cktl.licores.join(', ') + '<br>');
        $('#cocktail_info').append('<span class=\"title_section\">' + i18n["Carbonico"][locale] + ': </span> ' + cktl.carbonico + '<br>' + '<span class=\"title_section\">' + i18n["Vaso"][locale] + ': </span> ' + cktl.vaso + '<br>');
        $('#title').append(cktl.nombre + "</br>");

        if (cktl.rating > 0) {
          var rating = rating2Image(cktl.rating);
          $('#div_rating').append('<img src="' + rating + '" alt="Puntuacion" />');
        }
        if (user_name == "Sinatra Cockteleria") {
          $('.div_more_id').hide();
          $('.div_rate').hide();
        } else {
          $('#a_more').click(function() {
            loadPage('cocktails.html', {
              type : 'user',
              id : cktl.creador
            });
          });
          $('#a_rate').click(function() {
            $.ajax({
              type : "GET",
              url : server_url + "/ratings/" + getUrlParameters("id").id + "/" + window.localStorage.getItem("fb_id"),
              dataType : "json",
              async : false,
              success : function(data){
                loadPage('rating.html', {type: 'user', rating: data.rating, c_id: cktl._id, u_id: cktl.creador, imagen: cktl.imagen, nombre: cktl.nombre});
              },
              error: function(header, status, from){
                alert("Error con el servidor");
              }
            });
          });
          $('#a_share').click(function(){
            $('#shareImg').attr('src', '../images/ic_cocktail_share_hover.png');
            var t=setTimeout(function(){
              $('#shareImg').attr('src', '../images/ic_cocktail_share.png');
            },250);
            lookCocktail(cocktail.nombre, cktl._id, cktl.imagen);
          });
        }
      }

    </script>
    <style>
      .div_more_id {
        font-family: customFont;
        clear: both;
        float: left;
        margin-left: 4%;
        width: 130px;
        text-align: center;
      }

      .div_rate {
        font-family: customFont;
        float: right;
        margin-right: 4%;
        width: 130px;
        text-align: center;
      }
      
      .div_share{
        font-family: customFont;
        width: 100%;
        text-align: center;
      }

      #div_rating {
        float: right;
        margin-right: 5%;
        width: 25%;
      }

      @font-face {
        font-family: customFont;
        src: url('../fonts/knewave.ttf');
      }

      .field {
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <!-- This initializes the Facebook JS SDK. -->
    <div id="fb-root"></div>
    
    <div id="action">
      <div id="loading-icon"></div>
    
      <div id="msg"></div>
    </div>
    
    <div class="content">
      <div id="header2">
        <img class="logo" src="../images/logo_petit.png" alt="Sinatra Cocteleria" onclick="loadPage('index.html')"/>
      </div>
      <div id="cocktail">
        <div id="title" class="title_section"></div>
        <div id="info" style="display: none;">
          <img id="cocktail_image" />
          <div class="div_share">
            <a id="a_share" style="-webkit-tap-highlight-color: rgba(255, 255, 255, 0);"> <img id="shareImg" src="../images/ic_cocktail_share.png" alt="Compartir" />
              <p style="color: white; text-decoration: none;" data-i18n="share"></p>
            </a>
          </div>
          <div id="div_rating"></div>
          <div id="cocktail_info" style="width: 65%;"></div>
        </div>
        <div class="div_more_id" style="float:left;">
          <a id="a_more" style="-webkit-tap-highlight-color: rgba(255, 255, 255, 0);"> <img id="cocktailMoreImg" src="../images/ic_cocktail_zoom.png" alt="Ver mas cocktails" />
            <p style="color: white; text-decoration: none;" data-i18n="more_cocktails"></p>
          </a>
        </div>
        <div class="div_rate" id="div_rate_id" style="float: right;">
          <a id="a_rate" style="-webkit-tap-highlight-color: rgba(255, 255, 255, 0);"> <img id="cocktailStarImg" class="button-main-menu" src="../images/ic_cocktail_star.png"/>
            <p style="color: white; text-decoration: none;" data-i18n="rating_cocktail"></p>
          </a>
        </div>
      </div>
    </div>
  </body>
</html>
